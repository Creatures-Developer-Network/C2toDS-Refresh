* Autogenerated by the Creatures Map Editor
* For more info see http://cdn.creatures.net

* Addon file: deletes existing metarooms at the same place, same background name
* 2 metarooms, 823 rooms, 1489 doors

doif mapw lt 200000
  mapd 200000 200000
endi


setv va00 gmap 12942 47900
doif va00 <> -1
* check it is made from the same background
  doif bkds va00 <> "C2toDSTemple"
    outs "background"
    stop
  endi
* Delete any map editor alerters still left over
  enum 1 1 229
    kill targ
  next
* Check for any agents in the metaroom
  enum 0 0 0
    setv va32 attr
    andv va32 32
    doif va32 ne 32
      doif targ ne pntr
        doif gmap posx posy = va00 and carr = null
          cmrt 0
          seta va33 targ
          new: comp 1 1 229 "blank" 1 0 9000
          attr 32
          frel va33
          pat: fixd 1 "blank" 0 0 0 0 "whiteontransparentchars"
          flto 0 30
          part 1
          ptxt "Map editor can't change this meta room; I'm still in it"
          outs "agent"
          stop
        endi
      endi
    endi
  next
* delete all the rooms in the meta room
  sets va01 erid va00

  doif strl va01 > 0
    setv va03 1
    sets va98 ""
    loop
      setv va99 char va01 va03
      doif va99 = ' '
        doif va98 <> ""
          delr stoi va98
          sets va98 ""
        endi
      else
        sets va50 " "
        char va50 1 va99
        adds va98 va50
      endi
      addv va03 1
    untl va03 > strl va01
    doif va98 <> ""
      delr stoi va98
      sets va98 ""
    endi
  endi

* delete the metaroom itself
  delm va00

endi

setv game "mapeditortmp" addm 12448 47600 988 600 "C2toDSTemple"
mmsc 12942 47900 ""
setv va00 addr game "mapeditortmp" 12500 12624 47728 47728 48059 48078
rtyp va00 7
rmsc 12562 47903 ""
setv game "mapeditortmp_0" va00
setv va00 addr game "mapeditortmp" 12546 13341 47695 47695 47728 47728
rtyp va00 0
rmsc 12943 47711 ""
setv game "mapeditortmp_1" va00
setv va00 addr game "mapeditortmp" 12572 13320 47664 47665 47695 47695
rtyp va00 0
rmsc 12946 47679 ""
setv game "mapeditortmp_2" va00
setv va00 addr game "mapeditortmp" 12608 13277 47635 47635 47664 47665
rtyp va00 0
rmsc 12942 47650 ""
setv game "mapeditortmp_3" va00
setv va00 addr game "mapeditortmp" 12635 13253 47600 47600 47635 47635
rtyp va00 0
rmsc 12944 47617 ""
setv game "mapeditortmp_4" va00
setv va00 addr game "mapeditortmp" 13095 13221 47728 47728 48046 48067
rtyp va00 7
rmsc 13158 47897 ""
setv game "mapeditortmp_5" va00
setv va00 addr game "mapeditortmp" 12879 13026 47874 47874 48009 48009
rtyp va00 0
rmsc 12952 47941 ""
setv game "mapeditortmp_6" va00
setv va00 addr game "mapeditortmp" 12879 13026 48009 48009 48086 48085
rtyp va00 7
rmsc 12952 48047 ""
setv game "mapeditortmp_7" va00
setv va00 addr game "mapeditortmp" 13095 13221 48046 48067 48085 48083
rtyp va00 7
rmsc 13158 48064 ""
setv game "mapeditortmp_8" va00
setv va00 addr game "mapeditortmp" 13221 13387 47728 47728 48083 48065
rtyp va00 7
rmsc 13304 47896 ""
setv game "mapeditortmp_9" va00
setv va00 addr game "mapeditortmp" 13026 13095 47728 47728 48085 48085
rtyp va00 7
rmsc 13060 47906 ""
setv game "mapeditortmp_10" va00
setv va00 addr game "mapeditortmp" 12624 12816 47728 47728 48060 48053
rtyp va00 7
rmsc 12720 47890 ""
setv game "mapeditortmp_11" va00
setv va00 addr game "mapeditortmp" 12624 12816 48060 48053 48078 48081
rtyp va00 7
rmsc 12720 48070 ""
setv game "mapeditortmp_12" va00
setv va00 addr game "mapeditortmp" 12816 12879 47728 47728 48081 48086
rtyp va00 7
rmsc 12847 47907 ""
setv game "mapeditortmp_13" va00
setv va00 addr game "mapeditortmp" 12913 12938 47860 47833 47874 47874
rtyp va00 0
rmsc 12925 47867 ""
setv game "mapeditortmp_14" va00
setv va00 addr game "mapeditortmp" 12938 12975 47833 47833 47874 47874
rtyp va00 0
rmsc 12956 47853 ""
setv game "mapeditortmp_15" va00
setv va00 addr game "mapeditortmp" 12975 12999 47833 47860 47874 47874
rtyp va00 0
rmsc 12987 47853 ""
setv game "mapeditortmp_16" va00
setv va00 addr game "mapeditortmp" 12879 12913 47728 47728 47874 47874
rtyp va00 0
rmsc 12896 47801 ""
setv game "mapeditortmp_17" va00
setv va00 addr game "mapeditortmp" 12999 13026 47728 47728 47874 47874
rtyp va00 0
rmsc 13012 47801 ""
setv game "mapeditortmp_18" va00
setv va00 addr game "mapeditortmp" 12975 12999 47728 47728 47833 47860
rtyp va00 0
rmsc 12987 47794 ""
setv game "mapeditortmp_19" va00
setv va00 addr game "mapeditortmp" 12938 12975 47728 47728 47833 47833
rtyp va00 0
rmsc 12956 47780 ""
setv game "mapeditortmp_20" va00
setv va00 addr game "mapeditortmp" 12913 12938 47728 47728 47860 47833
rtyp va00 0
rmsc 12925 47780 ""
setv game "mapeditortmp_21" va00

setv va00 gmap 6224 48800
doif va00 <> -1
* check it is made from the same background
  doif bkds va00 <> "C2toDS,c2tods_night"
    outs "background"
    stop
  endi
* Delete any map editor alerters still left over
  enum 1 1 229
    kill targ
  next
* Check for any agents in the metaroom
  enum 0 0 0
    setv va32 attr
    andv va32 32
    doif va32 ne 32
      doif targ ne pntr
        doif gmap posx posy = va00 and carr = null
          cmrt 0
          seta va33 targ
          new: comp 1 1 229 "blank" 1 0 9000
          attr 32
          frel va33
          pat: fixd 1 "blank" 0 0 0 0 "whiteontransparentchars"
          flto 0 30
          part 1
          ptxt "Map editor can't change this meta room; I'm still in it"
          outs "agent"
          stop
        endi
      endi
    endi
  next
* delete all the rooms in the meta room
  sets va01 erid va00

  doif strl va01 > 0
    setv va03 1
    sets va98 ""
    loop
      setv va99 char va01 va03
      doif va99 = ' '
        doif va98 <> ""
          delr stoi va98
          sets va98 ""
        endi
      else
        sets va50 " "
        char va50 1 va99
        adds va98 va50
      endi
      addv va03 1
    untl va03 > strl va01
    doif va98 <> ""
      delr stoi va98
      sets va98 ""
    endi
  endi

* delete the metaroom itself
  delm va00

endi
